# Exercise 01 — Entity validation by CRUD (Проверка сущности по CRUD)

Задача: 1 — Sign up for a haircut (prefix: `bsh`)

Основание: `src/bsh/ex00_bsh_entity.md`, описание задачи в `README.md`, роли из `src/bsh/ex00_bsh_stakeholders.md`.

Обозначения:
- **Клиент** — st001002 (зарегистрированный), **Гость** — st001003
- **Мастер** — st001004, **Менеджер** — st001005, **Админ** — st001006
- **Система** — автоматические действия платформы
- **Уведомления** — st001010 (внешний сервис), **Платежи** — st001011 (внешний провайдер), **Бухгалтерия** — st001009
- `DELETE` для ряда сущностей трактуется как *деактивация/архивация*, т.к. физическое удаление часто недопустимо. Неясные места помечены **[УТОЧНИТЬ]** или **[ГИПОТЕЗА]**.

## CRUD-матрица (роль → действие)

| Сущность | CREATE: роль | CREATE: действие | READ: роль | READ: действие | UPDATE: роль | UPDATE: действие | DELETE: роль | DELETE: действие |
|---|---|---|---|---|---|---|---|---|
| Филиал (BarbershopBranch) | Админ/Менеджер | создаёт карточку филиала | Клиент/Гость/Менеджер/Мастер | просматривает адрес/контакты, выбор филиала | Админ/Менеджер | изменяет адрес/контакты/статус работы | Админ | **[ГИПОТЕЗА]** переводит в неактивный (не удаляет физически) |
| Клиент (UserAccount) | Клиент; Менеджер | регистрируется сам; **[УТОЧНИТЬ]** менеджер заводит аккаунт по обращению | Клиент; Менеджер; Админ | просматривает профиль/контакты/согласия | Клиент; Админ | меняет контакты/канал; админ блокирует/меняет статус | Админ | **[УТОЧНИТЬ]** удаление vs анонимизация по запросу пользователя |
| Гость (GuestContact) | Система | создаёт контакт гостя при записи (минимальные данные) | Менеджер; **[УТОЧНИТЬ]** Гость | менеджер видит контакт в записи; гость видит данные в ссылке/коде | Система; Менеджер | фиксирует подтверждение контакта; менеджер корректирует телефон | Система | **[ГИПОТЕЗА]** удаляет/анонимизирует по сроку хранения |
| Услуга (Service) | Менеджер | создаёт услугу, задаёт цену/длительность | Клиент/Гость/Менеджер/Мастер | просматривает каталог услуг | Менеджер | изменяет цену/длительность/доступность | Менеджер | переводит в архив/неактивна (не удаляет) |
| Мастер (Master) | Менеджер | заводит мастера, привязывает к филиалу/услугам | Клиент/Гость/Менеджер/Мастер | просматривает профили/доступные услуги | Менеджер; Мастер | меняет доступность/навыки; **[УТОЧНИТЬ]** мастер редактирует профиль | Менеджер | переводит в неактивный (уволен/не работает) |
| Слот расписания (ScheduleSlot) | Менеджер | создаёт слоты, блокировки, перерывы | Клиент/Гость/Мастер/Менеджер | просматривает свободные слоты и загрузку | Менеджер | меняет статус (free/blocked), переносит/корректирует интервалы | Менеджер | **[ГИПОТЕЗА]** “удаление” = закрыть слот/перевести в архив (аудит важен) |
| Запись (Appointment) | Клиент/Гость; Менеджер | создаёт запись на услугу; менеджер создаёт вручную | Клиент/Гость; Мастер; Менеджер | смотрит статус/детали записи, расписание визитов | Клиент/Гость; Менеджер | переносит/отменяет по правилам (cut‑off); менеджер правит при исключениях | Клиент/Менеджер | **[ГИПОТЕЗА]** удаление запрещено → отмена/архив (status=cancelled/archived) |
| Напоминание/уведомление (Notification) | Система | планирует/создаёт уведомления по событиям и расписанию | Клиент; Менеджер; **[УТОЧНИТЬ]** Админ | клиент получает; менеджер видит статус доставки | Система; Уведомления | обновляет статус доставки (sent/failed) по webhook | Система | **[ГИПОТЕЗА]** удаление по TTL/архивация для хранения истории |
| Оплата (Payment) | Менеджер; Платежи | менеджер фиксирует офлайн оплату; провайдер создаёт транзакцию онлайн | Клиент; Менеджер; Бухгалтерия | просматривают статус/сумму/реестр оплат | Платежи; Менеджер | обновляет статус платежа; менеджер корректирует метод/комментарий | Админ | **[УТОЧНИТЬ]** удаление запрещено → только сторно/возврат/архив |
| Отзыв/оценка (Review) | Клиент | создаёт отзыв после визита | Клиент; Мастер; Менеджер; Руководитель | просматривают отзывы/оценки и статистику | Клиент; Менеджер | **[УТОЧНИТЬ]** редактирование возможно в окне N минут; менеджер модерирует | Менеджер | удаляет/скрывает публикацию (**[УТОЧНИТЬ]** политика хранения/модерации) |

